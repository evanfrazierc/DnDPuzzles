(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,r){t.exports=r("zUnb")},zUnb:function(t,e,r){"use strict";r.r(e);var o=r("jhN1"),c=r("fXoL"),n=r("tk/3"),b=r("tyNb");let s=(()=>{class t{constructor(){this.title="Shop"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Cb({type:t,selectors:[["the-shop"]],decls:5,vars:1,consts:[[1,"row"],[1,"col-md-3","offset-md-3","text-center"]],template:function(t,e){1&t&&(c.Lb(0,"div",0),c.Lb(1,"div",1),c.Lb(2,"h3"),c.gc(3),c.Kb(),c.Kb(),c.Jb(4,"router-outlet"),c.Kb()),2&t&&(c.yb(3),c.hc(e.title))},directives:[b.d],encapsulation:2}),t})();var i=r("lJxs");class a{}class d{constructor(){this.orderDate=new Date,this.orderNumber=Math.random().toString(36).substr(2,5),this.items=[]}get subtotal(){return this.items.reduce((t,e)=>t+e.unitPrice*e.quantity,0)}}let u=(()=>{class t{constructor(t){this.http=t,this.products=[],this.order=new d,this.token="",this.expiration=new Date}loadProducts(){return this.http.get("/api/products").pipe(Object(i.a)(t=>{this.products=t}))}get loginRequired(){return 0===this.token.length||this.expiration>new Date}login(t){return this.http.post("/account/createtoken",t).pipe(Object(i.a)(t=>{this.token=t.token,this.expiration=t.expiration}))}checkout(){const t=(new n.c).set("Authorization",`Bearer ${this.token}`);return this.http.post("/api/orders",this.order,{headers:t}).pipe(Object(i.a)(()=>{this.order=new d}))}addToOrder(t){let e;e=this.order.items.find(e=>e.productId===t.id),e?e.quantity++:(e=new a,e.productId=t.id,e.productTitle=t.title,e.productPuzzleId=t.puzzleId,e.productCreator=t.creator,e.productCategory=t.category,e.unitPrice=t.price,e.quantity=1,this.order.items.push(e))}}return t.\u0275fac=function(e){return new(e||t)(c.Pb(n.a))},t.\u0275prov=c.Eb({token:t,factory:t.\u0275fac}),t})();var l=r("ofXK");function g(t,e){if(1&t&&(c.Lb(0,"div",9),c.gc(1),c.Kb()),2&t){const t=c.Ub();c.yb(1),c.hc(t.errorMessage)}}function p(t,e){if(1&t&&(c.Lb(0,"tr"),c.Lb(1,"td"),c.Jb(2,"img",10),c.Kb(),c.Lb(3,"td"),c.gc(4),c.Kb(),c.Lb(5,"td"),c.gc(6),c.Kb(),c.Lb(7,"td"),c.gc(8),c.Vb(9,"currency"),c.Kb(),c.Lb(10,"td"),c.gc(11),c.Vb(12,"currency"),c.Kb(),c.Kb()),2&t){const t=e.$implicit;c.yb(2),c.Zb("src","/img/",t.productPuzzleId,".jpg",c.dc),c.yb(2),c.jc("",t.productCategory," - ",t.productCreator,": ",t.productTitle,""),c.yb(2),c.hc(t.quantity),c.yb(2),c.hc(c.Wb(9,7,t.unitPrice)),c.yb(3),c.hc(c.Wb(12,9,t.unitPrice*t.quantity))}}let h=(()=>{class t{constructor(t,e){this.store=t,this.router=e,this.errorMessage=""}onCheckout(){this.errorMessage="",this.store.checkout().subscribe(()=>{this.router.navigate(["/"])},t=>{this.errorMessage=`Failed to checkout: ${t}`})}}return t.\u0275fac=function(e){return new(e||t)(c.Ib(u),c.Ib(b.a))},t.\u0275cmp=c.Cb({type:t,selectors:[["checkout"]],decls:29,vars:8,consts:[[1,"row"],["class","alert alert-danger",4,"ngIf"],[1,"table","table-bordered","table-hover"],[4,"ngFor","ngForOf"],[1,"col-md-4","col-md-offset-8","text-right"],[1,"table","table-condensed"],[1,"text-right"],[1,"btn","btn-success",3,"click"],["routerLink","/",1,"btn","btn-info"],[1,"alert","alert-danger"],["alt","o.productTitle",1,"img-thumbnail","checkout-thumb",3,"src"]],template:function(t,e){1&t&&(c.Lb(0,"div",0),c.Lb(1,"h3"),c.gc(2,"Confirm Order"),c.Kb(),c.fc(3,g,2,1,"div",1),c.Lb(4,"table",2),c.fc(5,p,13,11,"tr",3),c.Kb(),c.Lb(6,"div",4),c.Lb(7,"table",5),c.Lb(8,"tr"),c.Lb(9,"td",6),c.gc(10,"Subtotal"),c.Kb(),c.Lb(11,"td",6),c.gc(12),c.Vb(13,"currency"),c.Kb(),c.Kb(),c.Lb(14,"tr"),c.Lb(15,"td",6),c.gc(16,"Shipping"),c.Kb(),c.Lb(17,"td",6),c.gc(18,"$ 0.00"),c.Kb(),c.Kb(),c.Lb(19,"tr"),c.Lb(20,"td",6),c.gc(21,"Total:"),c.Kb(),c.Lb(22,"td",6),c.gc(23),c.Vb(24,"currency"),c.Kb(),c.Kb(),c.Kb(),c.Lb(25,"button",7),c.Sb("click",function(){return e.onCheckout()}),c.gc(26,"Complete Purchase"),c.Kb(),c.Lb(27,"a",8),c.gc(28,"Cancel"),c.Kb(),c.Kb(),c.Kb()),2&t&&(c.yb(3),c.Xb("ngIf",e.errorMessage),c.yb(2),c.Xb("ngForOf",e.store.order.items),c.yb(7),c.hc(c.Wb(13,4,e.store.order.subtotal)),c.yb(11),c.hc(c.Wb(24,6,e.store.order.subtotal)))},directives:[l.k,l.j,b.b],pipes:[l.c],styles:[".checkout-thumb[_ngcontent-%COMP%]{max-width:100px}"]}),t})();var f=r("3Pt+");function L(t,e){if(1&t&&(c.Lb(0,"div",14),c.gc(1),c.Kb()),2&t){const t=c.Ub();c.yb(1),c.hc(t.errorMessage)}}function m(t,e){1&t&&(c.Lb(0,"div",15),c.gc(1,"Required"),c.Kb())}function y(t,e){1&t&&(c.Lb(0,"div",15),c.gc(1,"Required"),c.Kb())}let K=(()=>{class t{constructor(t,e){this.store=t,this.router=e,this.creds={username:"",password:""},this.errorMessage=""}onLogin(){this.store.login(this.creds).subscribe(()=>{this.router.navigate(this.store.order.items.length>0?["checkout"]:[""])},t=>{console.log(t),this.errorMessage="Failed to login"})}}return t.\u0275fac=function(e){return new(e||t)(c.Ib(u),c.Ib(b.a))},t.\u0275cmp=c.Cb({type:t,selectors:[["login-page"]],decls:23,vars:9,consts:[[1,"row"],[1,"col-md-4","col-md-offset-4"],["class","alert alert-danger",4,"ngIf"],[3,"submit"],[1,"form-group"],["for","username"],["type","text","name","name","required","",1,"form-control",3,"ngModel","ngModelChange"],["username","ngModel"],["class","text-danger",4,"ngIf"],["for","password"],["type","password","name","password","required","",1,"form-control",3,"ngModel","ngModelChange"],["password","ngModel"],["type","submit","value","Login",1,"btn","btn-success",3,"disabled"],["href","#",1,"btn","btn-default"],[1,"alert","alert-danger"],[1,"text-danger"]],template:function(t,e){if(1&t&&(c.Lb(0,"div",0),c.Lb(1,"div",1),c.fc(2,L,2,1,"div",2),c.Lb(3,"form",3),c.Sb("submit",function(){return e.onLogin()}),c.Lb(4,"div",4),c.Lb(5,"label",5),c.gc(6,"Username"),c.Kb(),c.Lb(7,"input",6,7),c.Sb("ngModelChange",function(t){return e.creds.username=t}),c.Kb(),c.fc(9,m,2,0,"div",8),c.Kb(),c.Lb(10,"div",4),c.Lb(11,"label",9),c.gc(12,"Password"),c.Kb(),c.Lb(13,"input",10,11),c.Sb("ngModelChange",function(t){return e.creds.password=t}),c.Kb(),c.fc(15,y,2,0,"div",8),c.Kb(),c.Lb(16,"div",4),c.Jb(17,"input",12),c.Lb(18,"a",13),c.gc(19,"Cancel"),c.Kb(),c.Kb(),c.Kb(),c.Lb(20,"div"),c.gc(21),c.Vb(22,"json"),c.Kb(),c.Kb(),c.Kb()),2&t){const t=c.bc(8),r=c.bc(14);c.yb(2),c.Xb("ngIf",e.errorMessage),c.yb(5),c.Xb("ngModel",e.creds.username),c.yb(2),c.Xb("ngIf",t.touched&&t.invalid&&t.errors.required),c.yb(4),c.Xb("ngModel",e.creds.password),c.yb(2),c.Xb("ngIf",r.touched&&r.invalid&&r.errors.required),c.yb(2),c.Xb("disabled",t.invalid||r.invalid),c.yb(4),c.hc(c.Wb(22,7,e.creds))}},directives:[l.k,f.h,f.d,f.e,f.a,f.g,f.c,f.f],pipes:[l.f],encapsulation:2}),t})();function v(t,e){if(1&t){const t=c.Mb();c.Lb(0,"div",2),c.Lb(1,"div",3),c.Lb(2,"div",4),c.Jb(3,"img",5),c.Lb(4,"h5"),c.gc(5),c.Kb(),c.Lb(6,"ul",6),c.Lb(7,"li"),c.gc(8),c.Kb(),c.Lb(9,"li"),c.gc(10),c.Vb(11,"currency"),c.Kb(),c.Lb(12,"li"),c.gc(13),c.Kb(),c.Lb(14,"li"),c.gc(15),c.Kb(),c.Kb(),c.Lb(16,"button",7),c.Sb("click",function(){c.cc(t);const r=e.$implicit;return c.Ub().store.addToOrder(r)}),c.gc(17,"Buy"),c.Kb(),c.Kb(),c.Kb(),c.Kb()}if(2&t){const t=e.$implicit;c.yb(3),c.Zb("src","/img/",t.puzzleId,".jpg",c.dc),c.Yb("alt",t.creator),c.yb(2),c.hc(t.title),c.yb(3),c.ic("Category: ",t.category,""),c.yb(2),c.ic("Price: ",c.Wb(11,7,t.price),""),c.yb(3),c.ic("Creator: ",t.creator,""),c.yb(2),c.hc(t.puzzleDescription)}}var w=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.loadProducts().subscribe(()=>{})}}return t.\u0275fac=function(e){return new(e||t)(c.Ib(u))},t.\u0275cmp=c.Cb({type:t,selectors:[["product-list"]],decls:2,vars:1,consts:[[1,"row"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"border","bg-light","rounded","p-2"],[1,"p-1","m-1"],[1,"img-fluid","product-image","shadow-none",3,"src","alt"],[1,"products-props"],["id","buyButton",1,"btn","btn-success",3,"click"]],template:function(t,e){1&t&&(c.Lb(0,"div",0),c.fc(1,v,18,9,"div",1),c.Kb()),2&t&&(c.yb(1),c.Xb("ngForOf",e.store.products))},directives:[l.j],pipes:[l.c],styles:[".product-image[_ngcontent-%COMP%]{border:1px solid #ddd;box-shadow:2px 2px rgba(0,0,0,.4);margin:2px}.products-props[_ngcontent-%COMP%]{font-size:.9rem;padding-top:1px;padding-bottom:1px}"]}),t})();function k(t,e){if(1&t&&(c.Lb(0,"tr"),c.Lb(1,"td"),c.Jb(2,"img",4),c.Kb(),c.Lb(3,"td"),c.gc(4),c.Kb(),c.Lb(5,"td"),c.gc(6),c.Kb(),c.Lb(7,"td"),c.gc(8),c.Vb(9,"currency"),c.Kb(),c.Lb(10,"td"),c.gc(11),c.Vb(12,"currency"),c.Kb(),c.Kb()),2&t){const t=e.$implicit;c.yb(2),c.Zb("src","/img/",t.productPuzzleId,".jpg",c.dc),c.Yb("alt",t.productCreator),c.yb(2),c.hc(t.productCategory),c.yb(2),c.hc(t.quantity),c.yb(2),c.hc(c.Wb(9,6,t.unitPrice)),c.yb(3),c.hc(c.Wb(12,8,t.unitPrice*t.quantity))}}function C(t,e){1&t&&(c.Lb(0,"a",5),c.gc(1,"Checkout"),c.Kb())}let M=(()=>{class t{constructor(t){this.store=t}}return t.\u0275fac=function(e){return new(e||t)(c.Ib(u))},t.\u0275cmp=c.Cb({type:t,selectors:[["cart"]],decls:26,vars:6,consts:[[1,"table","table-condensed","table-striped"],[4,"ngFor","ngForOf"],["colspan","5"],["class","btn btn-success","routerLink","checkout",4,"ngIf"],[1,"img-fluid","product-thumb",3,"src","alt"],["routerLink","checkout",1,"btn","btn-success"]],template:function(t,e){1&t&&(c.Lb(0,"h3"),c.gc(1,"Cart"),c.Kb(),c.Lb(2,"div"),c.gc(3),c.Kb(),c.Lb(4,"table",0),c.Lb(5,"thead"),c.Lb(6,"tr"),c.Jb(7,"th"),c.Lb(8,"th"),c.gc(9,"Product"),c.Kb(),c.Lb(10,"th"),c.gc(11,"Quantity"),c.Kb(),c.Lb(12,"th"),c.gc(13,"Price"),c.Kb(),c.Lb(14,"th"),c.gc(15,"Total"),c.Kb(),c.Kb(),c.Kb(),c.Lb(16,"tbody"),c.fc(17,k,13,10,"tr",1),c.Kb(),c.Lb(18,"tfoot"),c.Lb(19,"tr"),c.Lb(20,"td",2),c.Lb(21,"strong"),c.gc(22),c.Vb(23,"currency"),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.fc(24,C,2,0,"a",3),c.Jb(25,"hr")),2&t&&(c.yb(3),c.ic("Count: ",e.store.order.items.length,""),c.yb(14),c.Xb("ngForOf",e.store.order.items),c.yb(5),c.ic("Subtotal: ",c.Wb(23,4,e.store.order.subtotal),""),c.yb(2),c.Xb("ngIf",e.store.order.items.length>0))},directives:[l.j,l.k,b.b],pipes:[l.c],styles:[".product-thumb[_ngcontent-%COMP%]{max-width:50px}"]}),t})(),P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Cb({type:t,selectors:[["shop-page"]],decls:5,vars:0,consts:[[1,"row"],[1,"col-9"],[1,"col-3"]],template:function(t,e){1&t&&(c.Lb(0,"div",0),c.Lb(1,"div",1),c.Jb(2,"product-list"),c.Kb(),c.Lb(3,"div",2),c.Jb(4,"cart"),c.Kb(),c.Kb())},directives:[w,M],encapsulation:2}),t})(),x=(()=>{class t{constructor(t,e){this.store=t,this.router=e}canActivate(t,e){return!this.store.loginRequired||(this.router.navigate(["login"]),!1)}}return t.\u0275fac=function(e){return new(e||t)(c.Pb(u),c.Pb(b.a))},t.\u0275prov=c.Eb({token:t,factory:t.\u0275fac}),t})();var I=b.c.forRoot([{path:"",component:P},{path:"checkout",component:h,canActivate:[x]},{path:"login",component:K},{path:"**",redirectTo:"/"}],{useHash:!1});let O=(()=>{class t{}return t.\u0275mod=c.Gb({type:t,bootstrap:[s]}),t.\u0275inj=c.Fb({factory:function(e){return new(e||t)},providers:[u,x],imports:[[o.a,n.b,I,f.b]]}),t})();Object(c.S)(),o.b().bootstrapModule(O).catch(t=>console.error(t))},zn8P:function(t,e){function r(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="zn8P"}},[[0,0,4]]]);