(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,r){t.exports=r("zUnb")},zUnb:function(t,e,r){"use strict";r.r(e);var c=r("jhN1"),o=r("fXoL"),n=r("tk/3"),b=r("tyNb");let s=(()=>{class t{constructor(){this.title="Shop"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Cb({type:t,selectors:[["the-shop"]],decls:5,vars:1,consts:[[1,"row"],[1,"col-12"]],template:function(t,e){1&t&&(o.Lb(0,"div",0),o.Lb(1,"div",1),o.Lb(2,"h3"),o.gc(3),o.Kb(),o.Jb(4,"router-outlet"),o.Kb(),o.Kb()),2&t&&(o.yb(3),o.hc(e.title))},directives:[b.d],encapsulation:2}),t})();var i=r("lJxs");class a{}class u{constructor(){this.orderDate=new Date,this.orderNumber=Math.random().toString(36).substr(2,5),this.items=[]}get subtotal(){return this.items.reduce((t,e)=>t+e.unitPrice*e.quantity,0)}}let d=(()=>{class t{constructor(t){this.http=t,this.products=[],this.order=new u,this.token="",this.expiration=new Date}loadProducts(){return this.http.get("/api/products").pipe(Object(i.a)(t=>{this.products=t}))}get loginRequired(){return 0===this.token.length||this.expiration>new Date}login(t){return this.http.post("/account/createtoken",t).pipe(Object(i.a)(t=>{this.token=t.token,this.expiration=t.expiration}))}checkout(){const t=(new n.c).set("Authorization",`Bearer ${this.token}`);return this.http.post("/api/orders",this.order,{headers:t}).pipe(Object(i.a)(()=>{this.order=new u}))}addToOrder(t){let e;e=this.order.items.find(e=>e.productId===t.id),e?e.quantity++:(e=new a,e.productId=t.id,e.productTitle=t.title,e.productPuzzleId=t.puzzleId,e.productCreator=t.creator,e.productCategory=t.category,e.unitPrice=t.price,e.quantity=1,this.order.items.push(e))}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(n.a))},t.\u0275prov=o.Eb({token:t,factory:t.\u0275fac}),t})();var l=r("ofXK");function g(t,e){if(1&t&&(o.Lb(0,"div",9),o.gc(1),o.Kb()),2&t){const t=o.Ub();o.yb(1),o.hc(t.errorMessage)}}function p(t,e){if(1&t&&(o.Lb(0,"tr"),o.Lb(1,"td"),o.Jb(2,"img",10),o.Kb(),o.Lb(3,"td"),o.gc(4),o.Kb(),o.Lb(5,"td"),o.gc(6),o.Kb(),o.Lb(7,"td"),o.gc(8),o.Vb(9,"currency"),o.Kb(),o.Lb(10,"td"),o.gc(11),o.Vb(12,"currency"),o.Kb(),o.Kb()),2&t){const t=e.$implicit;o.yb(2),o.Zb("src","/img/",t.productPuzzleId,".jpg",o.dc),o.yb(2),o.jc("",t.productCategory," - ",t.productCreator,": ",t.productTitle,""),o.yb(2),o.hc(t.quantity),o.yb(2),o.hc(o.Wb(9,7,t.unitPrice)),o.yb(3),o.hc(o.Wb(12,9,t.unitPrice*t.quantity))}}let h=(()=>{class t{constructor(t,e){this.store=t,this.router=e,this.errorMessage=""}onCheckout(){this.errorMessage="",this.store.checkout().subscribe(()=>{this.router.navigate(["/"])},t=>{this.errorMessage=`Failed to checkout: ${t}`})}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(d),o.Ib(b.a))},t.\u0275cmp=o.Cb({type:t,selectors:[["checkout"]],decls:29,vars:8,consts:[[1,"row"],["class","alert alert-danger",4,"ngIf"],[1,"table","table-bordered","table-hover"],[4,"ngFor","ngForOf"],[1,"col-md-4","col-md-offset-8","text-right"],[1,"table","table-condensed"],[1,"text-right"],[1,"btn","btn-success",3,"click"],["routerLink","/",1,"btn","btn-info"],[1,"alert","alert-danger"],["alt","o.productTitle",1,"img-thumbnail","checkout-thumb",3,"src"]],template:function(t,e){1&t&&(o.Lb(0,"div",0),o.Lb(1,"h3"),o.gc(2,"Confirm Order"),o.Kb(),o.fc(3,g,2,1,"div",1),o.Lb(4,"table",2),o.fc(5,p,13,11,"tr",3),o.Kb(),o.Lb(6,"div",4),o.Lb(7,"table",5),o.Lb(8,"tr"),o.Lb(9,"td",6),o.gc(10,"Subtotal"),o.Kb(),o.Lb(11,"td",6),o.gc(12),o.Vb(13,"currency"),o.Kb(),o.Kb(),o.Lb(14,"tr"),o.Lb(15,"td",6),o.gc(16,"Shipping"),o.Kb(),o.Lb(17,"td",6),o.gc(18,"$ 0.00"),o.Kb(),o.Kb(),o.Lb(19,"tr"),o.Lb(20,"td",6),o.gc(21,"Total:"),o.Kb(),o.Lb(22,"td",6),o.gc(23),o.Vb(24,"currency"),o.Kb(),o.Kb(),o.Kb(),o.Lb(25,"button",7),o.Sb("click",function(){return e.onCheckout()}),o.gc(26,"Complete Purchase"),o.Kb(),o.Lb(27,"a",8),o.gc(28,"Cancel"),o.Kb(),o.Kb(),o.Kb()),2&t&&(o.yb(3),o.Xb("ngIf",e.errorMessage),o.yb(2),o.Xb("ngForOf",e.store.order.items),o.yb(7),o.hc(o.Wb(13,4,e.store.order.subtotal)),o.yb(11),o.hc(o.Wb(24,6,e.store.order.subtotal)))},directives:[l.k,l.j,b.b],pipes:[l.c],styles:[".checkout-thumb[_ngcontent-%COMP%]{max-width:100px}"]}),t})();var f=r("3Pt+");function L(t,e){if(1&t&&(o.Lb(0,"div",14),o.gc(1),o.Kb()),2&t){const t=o.Ub();o.yb(1),o.hc(t.errorMessage)}}function m(t,e){1&t&&(o.Lb(0,"div",15),o.gc(1,"Required"),o.Kb())}function y(t,e){1&t&&(o.Lb(0,"div",15),o.gc(1,"Required"),o.Kb())}let K=(()=>{class t{constructor(t,e){this.store=t,this.router=e,this.creds={username:"",password:""},this.errorMessage=""}onLogin(){this.store.login(this.creds).subscribe(()=>{this.router.navigate(this.store.order.items.length>0?["checkout"]:[""])},t=>{console.log(t),this.errorMessage="Failed to login"})}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(d),o.Ib(b.a))},t.\u0275cmp=o.Cb({type:t,selectors:[["login-page"]],decls:23,vars:9,consts:[[1,"row"],[1,"col-md-4","col-md-offset-4"],["class","alert alert-danger",4,"ngIf"],[3,"submit"],[1,"form-group"],["for","username"],["type","text","name","name","required","",1,"form-control",3,"ngModel","ngModelChange"],["username","ngModel"],["class","text-danger",4,"ngIf"],["for","password"],["type","password","name","password","required","",1,"form-control",3,"ngModel","ngModelChange"],["password","ngModel"],["type","submit","value","Login",1,"btn","btn-success",3,"disabled"],["href","#",1,"btn","btn-default"],[1,"alert","alert-danger"],[1,"text-danger"]],template:function(t,e){if(1&t&&(o.Lb(0,"div",0),o.Lb(1,"div",1),o.fc(2,L,2,1,"div",2),o.Lb(3,"form",3),o.Sb("submit",function(){return e.onLogin()}),o.Lb(4,"div",4),o.Lb(5,"label",5),o.gc(6,"Username"),o.Kb(),o.Lb(7,"input",6,7),o.Sb("ngModelChange",function(t){return e.creds.username=t}),o.Kb(),o.fc(9,m,2,0,"div",8),o.Kb(),o.Lb(10,"div",4),o.Lb(11,"label",9),o.gc(12,"Password"),o.Kb(),o.Lb(13,"input",10,11),o.Sb("ngModelChange",function(t){return e.creds.password=t}),o.Kb(),o.fc(15,y,2,0,"div",8),o.Kb(),o.Lb(16,"div",4),o.Jb(17,"input",12),o.Lb(18,"a",13),o.gc(19,"Cancel"),o.Kb(),o.Kb(),o.Kb(),o.Lb(20,"div"),o.gc(21),o.Vb(22,"json"),o.Kb(),o.Kb(),o.Kb()),2&t){const t=o.bc(8),r=o.bc(14);o.yb(2),o.Xb("ngIf",e.errorMessage),o.yb(5),o.Xb("ngModel",e.creds.username),o.yb(2),o.Xb("ngIf",t.touched&&t.invalid&&t.errors.required),o.yb(4),o.Xb("ngModel",e.creds.password),o.yb(2),o.Xb("ngIf",r.touched&&r.invalid&&r.errors.required),o.yb(2),o.Xb("disabled",t.invalid||r.invalid),o.yb(4),o.hc(o.Wb(22,7,e.creds))}},directives:[l.k,f.h,f.d,f.e,f.a,f.g,f.c,f.f],pipes:[l.f],encapsulation:2}),t})();function v(t,e){if(1&t){const t=o.Mb();o.Lb(0,"div",2),o.Lb(1,"div",3),o.Jb(2,"img",4),o.Lb(3,"h5"),o.gc(4),o.Kb(),o.Lb(5,"ul",5),o.Lb(6,"li"),o.gc(7),o.Kb(),o.Lb(8,"li"),o.gc(9),o.Vb(10,"currency"),o.Kb(),o.Lb(11,"li"),o.gc(12),o.Kb(),o.Lb(13,"li"),o.gc(14),o.Kb(),o.Kb(),o.Lb(15,"button",6),o.Sb("click",function(){o.cc(t);const r=e.$implicit;return o.Ub().store.addToOrder(r)}),o.gc(16,"Buy"),o.Kb(),o.Kb(),o.Kb()}if(2&t){const t=e.$implicit;o.yb(2),o.Zb("src","/img/",t.puzzleId,".jpg",o.dc),o.Yb("alt",t.creator),o.yb(2),o.hc(t.title),o.yb(3),o.ic("Category: ",t.category,""),o.yb(2),o.ic("Price: ",o.Wb(10,7,t.price),""),o.yb(3),o.ic("Creator: ",t.creator,""),o.yb(2),o.hc(t.puzzleDescription)}}var w=(()=>{class t{constructor(t){this.store=t}ngOnInit(){this.store.loadProducts().subscribe(()=>{})}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(d))},t.\u0275cmp=o.Cb({type:t,selectors:[["product-list"]],decls:2,vars:1,consts:[[1,"row"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"border","bg-light","rounded","p-1"],[1,"img-fluid","product-image",3,"src","alt"],[1,"products-props"],["id","buyButton",1,"btn","btn-success",3,"click"]],template:function(t,e){1&t&&(o.Lb(0,"div",0),o.fc(1,v,17,9,"div",1),o.Kb()),2&t&&(o.yb(1),o.Xb("ngForOf",e.store.products))},directives:[l.j],pipes:[l.c],styles:[".product-image[_ngcontent-%COMP%]{border:1px solid #ddd;box-shadow:2px 2px rgba(0,0,0,.4);margin:2px}.products-props[_ngcontent-%COMP%]{font-size:.9rem}"]}),t})();function k(t,e){if(1&t&&(o.Lb(0,"tr"),o.Lb(1,"td"),o.Jb(2,"img",4),o.Kb(),o.Lb(3,"td"),o.gc(4),o.Kb(),o.Lb(5,"td"),o.gc(6),o.Kb(),o.Lb(7,"td"),o.gc(8),o.Vb(9,"currency"),o.Kb(),o.Lb(10,"td"),o.gc(11),o.Vb(12,"currency"),o.Kb(),o.Kb()),2&t){const t=e.$implicit;o.yb(2),o.Zb("src","/img/",t.productPuzzleId,".jpg",o.dc),o.Yb("alt",t.productCreator),o.yb(2),o.hc(t.productCategory),o.yb(2),o.hc(t.quantity),o.yb(2),o.hc(o.Wb(9,6,t.unitPrice)),o.yb(3),o.hc(o.Wb(12,8,t.unitPrice*t.quantity))}}function C(t,e){1&t&&(o.Lb(0,"a",5),o.gc(1,"Checkout"),o.Kb())}let M=(()=>{class t{constructor(t){this.store=t}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(d))},t.\u0275cmp=o.Cb({type:t,selectors:[["cart"]],decls:26,vars:6,consts:[[1,"table","table-condensed","table-striped"],[4,"ngFor","ngForOf"],["colspan","5"],["class","btn btn-success","routerLink","checkout",4,"ngIf"],[1,"img-fluid","product-thumb",3,"src","alt"],["routerLink","checkout",1,"btn","btn-success"]],template:function(t,e){1&t&&(o.Lb(0,"h3"),o.gc(1,"Cart"),o.Kb(),o.Lb(2,"div"),o.gc(3),o.Kb(),o.Lb(4,"table",0),o.Lb(5,"thead"),o.Lb(6,"tr"),o.Jb(7,"th"),o.Lb(8,"th"),o.gc(9,"Product"),o.Kb(),o.Lb(10,"th"),o.gc(11,"Quantity"),o.Kb(),o.Lb(12,"th"),o.gc(13,"Price"),o.Kb(),o.Lb(14,"th"),o.gc(15,"Total"),o.Kb(),o.Kb(),o.Kb(),o.Lb(16,"tbody"),o.fc(17,k,13,10,"tr",1),o.Kb(),o.Lb(18,"tfoot"),o.Lb(19,"tr"),o.Lb(20,"td",2),o.Lb(21,"strong"),o.gc(22),o.Vb(23,"currency"),o.Kb(),o.Kb(),o.Kb(),o.Kb(),o.Kb(),o.fc(24,C,2,0,"a",3),o.Jb(25,"hr")),2&t&&(o.yb(3),o.ic("Count: ",e.store.order.items.length,""),o.yb(14),o.Xb("ngForOf",e.store.order.items),o.yb(5),o.ic("Subtotal: ",o.Wb(23,4,e.store.order.subtotal),""),o.yb(2),o.Xb("ngIf",e.store.order.items.length>0))},directives:[l.j,l.k,b.b],pipes:[l.c],styles:[".product-thumb[_ngcontent-%COMP%]{max-width:50px}"]}),t})(),P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Cb({type:t,selectors:[["shop-page"]],decls:5,vars:0,consts:[[1,"row"],[1,"col-9"],[1,"col-3"]],template:function(t,e){1&t&&(o.Lb(0,"div",0),o.Lb(1,"div",1),o.Jb(2,"product-list"),o.Kb(),o.Lb(3,"div",2),o.Jb(4,"cart"),o.Kb(),o.Kb())},directives:[w,M],encapsulation:2}),t})(),I=(()=>{class t{constructor(t,e){this.store=t,this.router=e}canActivate(t,e){return!this.store.loginRequired||(this.router.navigate(["login"]),!1)}}return t.\u0275fac=function(e){return new(e||t)(o.Pb(d),o.Pb(b.a))},t.\u0275prov=o.Eb({token:t,factory:t.\u0275fac}),t})();var x=b.c.forRoot([{path:"",component:P},{path:"checkout",component:h,canActivate:[I]},{path:"login",component:K},{path:"**",redirectTo:"/"}],{useHash:!1});let O=(()=>{class t{}return t.\u0275mod=o.Gb({type:t,bootstrap:[s]}),t.\u0275inj=o.Fb({factory:function(e){return new(e||t)},providers:[d,I],imports:[[c.a,n.b,x,f.b]]}),t})();Object(o.S)(),c.b().bootstrapModule(O).catch(t=>console.error(t))},zn8P:function(t,e){function r(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="zn8P"}},[[0,0,4]]]);